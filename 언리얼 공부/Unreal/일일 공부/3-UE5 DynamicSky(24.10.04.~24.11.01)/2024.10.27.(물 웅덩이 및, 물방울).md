#### Unreal Engine 5 : 강의 하나로 DynamicSky 시스템 완벽 마스터하기!

##### 100강 : 비오는 데이터 에셋
- 비오는 날씨 구현 절차
	- Lighting
	- Material
	- Interaction
	- Particles
- Rainy 구현 전 관련 Data들 추가
	- Enum 'EWeatherType'에 Rainy 추가
	![[Pasted image 20241027121419.png]]
	- 'DA_Rainy' 생성
	![[Pasted image 20241027121442.png]]
	- 'BP_DynamicSky'에서 'GetCurrentWeatherType' 변경
	![[Pasted image 20241027121517.png]]
	- 'BP_DynamicSky'에서 'HandleWeatherSetting' 변경
	![[Pasted image 20241027121556.png]]

##### 101강 : 비 오는 날을 위한 조명
*Lighting 구현*
- 비 오는 날씨에 맞춰 DA_Rainy 조명 설정
![[Pasted image 20241027140406.png]]
- 비 오는 날씨에는 2D Cloud가 되도록 설정
- 비 오는 날씨 구름 설정을 위해 새로운 구조체 S_RainyWeatherSettings 생성
![[Pasted image 20241027140453.png]]
- 해당 구조체를 통해 비오는 날 2D Clouds 날씨를 조정하는 Macro 'Set 2D Clouds Settings Rainy'생성(구조체를 Parent로 변수 'Rainy Weather Settings' 생성)
![[Pasted image 20241027140554.png]]
- Handle Cloud Setting에서 위의 사항들 구현
![[Pasted image 20241027140634.png]]

##### 102강 : 웅덩이의 속성
*Material 구현*
- 물 웅덩이(Puddle) 구현
	- Shape
	- Key Material Attributes(Base Color/Specula/Roughness/Normal)
	- Ripples(잔물결)
	- Waves(파도)
- 이번 강좌에서는 Shape과 Key Material Attributes 구현
- Puddle Example Material 생성
![[Pasted image 20241027142832.png]]
![[Pasted image 20241027142847.png]]
- Mask에서 필요한 Channel을 사용하고 싶을 때 사용하는 2가지 노드
![[Pasted image 20241027143018.png]]
- 이 두 노드의 동작은 거의 동일하나, Static의 경우 Runtime 도중에는 변경 불가능이라는 차이점 있음
- 결과
![[Pasted image 20241027143103.png]]

##### 103강 : 잔물결(Ripples)
- 이번 강좌에서는 Ripples 구현
- Flipbook Texture : 애니메이션도 처리해줌
- Ripple 구현
![[Pasted image 20241027144928.png]]
![[Pasted image 20241027145014.png]]
- 이때 Frac 사용이 중요 Frac은 정수부를 버리고 소수부만을 취함. 이를 통해 좌표를 각 쉘로 할당시켜줌(Flipbook 사용에 필수적)
- 구현한 CachedPuddleNormalOutput을 기존의 웅덩이의 Normal과 교환
![[Pasted image 20241027145041.png]]
---
- 잔물결이 가장자리를 넘어 생기는 문제 발생
	- 원인 : Mask의 값이 0~1 사이인 부분(0.01등)에도 잔물결이 생성되는 문제
	- 해결 : 잔물결이 사용하는 Mask에만 1 미만의 값들을 전부 제거
		1. 웅덩이 마스크를 재사용하기 위해 Cached 사용
		![[Pasted image 20241027145817.png]]
		2. Lerp와 Step 노드를 사용해서 잔물결용 마스크 추가 적용
		![[Pasted image 20241027145850.png]]

##### 104강 : 웅덩이 물결
- 웅덩이 애니메이션을 구현은 Normal에 Animation을 줘서 사용
- 내부 함수 'Motion4WayChoas_Normal'을 사용하여야 하나, 이는 라이브러리에 노출되어 있지 않으므로 우클릭 후 MotionFunctionCall(혹은 F누르고 왼쪽 클릭) 생성 후 해당 함수 할당
![[Pasted image 20241027151721.png]]
- 그러나 해당 함수 내부에는 문제가 있으므로 이를 복사하여 MF 생성 후 문제 해결하여 사용
![[Pasted image 20241027151804.png]]
- 수정한 해당 함수를 사용하여 Wave 구현
![[Pasted image 20241027153917.png]]
- 기존 잔물결 Normal과 결합해야함. Add를 쓸 수는 있으나 이는 Normal의 강도가 낮아지는 문제가 발생. BlendAngleCorrectedNormal 사용(Lerp 전에)
![[Pasted image 20241027154018.png]]

##### 105강 : MF_GenerateRainyWeatherPuddles
- 이전에 만들었던 Puddle Example Material의 기능을 그대로 가져온 MF_GenerateRainyWeatherPuddles 생성
![[Pasted image 20241027162234.png]]

##### 106강 : 스무스 스텝
- 경사면에도 물웅덩이가 있는 문제 : 경사쪽 Mask를 0으로 만들기
- 해결 법 : Smooth Step을 사용.
- Smooth Step : Min/Max/Value값을 입력으로 받아
	- Min > Value : 0
	- Max > Value > Min : 0~1
	- Value > Max : 1
	- 이를 사용하는 이유는 Max와 Min 사이일 시 Smooth하게 변환을 넣어 경계가 생기지 않도록 구현
- 적용
![[Pasted image 20241027173256.png]]

##### 107강 : 비 토글
- DA_Rainy가 아닐 때는 웅덩이가 없도록 Toggle Rain 구현
- MPC_Weather에 Is_Rainning 추가
![[Pasted image 20241027180705.png]]
- MF_GenerateRainyWeatherPuddle에 Is_Rainning이 1일 때만 웅덩이가 생기도록 노드 추가
![[Pasted image 20241027180755.png]]
- BP_DynamicSky에서 Toggle Rain 구현
![[Pasted image 20241027180815.png]]
- HandleWeatherSettings에서 Toggle Rain 추가
![[Pasted image 20241027180836.png]]

##### 108강 : 리퀴드 마스터 머터리얼
- Rain Particles 생성 과정
	- Liquid Material
	- Surface Interaction
	- Performance
- Liquid Master Material 생성(Blend Mode : Additive/Shading Model : Unlit)
![[Pasted image 20241027200758.png]]
![[Pasted image 20241027200813.png]]
![[Pasted image 20241027200843.png]]
![[Pasted image 20241027200902.png]]
![[Pasted image 20241027200917.png]]
- 전체 배치
![[Pasted image 20241027200936.png]]

##### 109강 : 메인 빗방울
- Particle의 두 종류
	- CPU Particle : 다량의 Paritcle 생성에 불리, 콜리전 등의 이벤트 처리 가능
	- GPU Particle : 다량의 Particle 생성에 유리, 콜리전 등의 이벤트 처리 불가
- 빗방울 아이디어 : 소량의 CPU Particle을 생성해서 Collision Event를 처리, 빈 곳을 채우기 위해 다량의 GPU Particle 생성
![[Pasted image 20241027201403.png]]
- NS_Rain 생성(base는 follow camera)
![[Pasted image 20241027202122.png]]
- Simple Sprite Burst Emitter 추가
![[Pasted image 20241027202143.png]]
- 내부 설정값 변경
	- Sprite Renderer에서 Material 설정
	- Sprite Renderer에서 Alighnment : Velocity Aligned
	- Sprite Renderer에서 Sub UV : 3-2
	- Particle Update에 새로운 Module 추가 : Sub UVAnimation / Dynamic Material Paramters
	- Sub UVAnimation에서 sprite 설정 : Sprite Renderer
	- Dynamic Material Parmeter에서 Random Float로 값 설정
	![[Pasted image 20241027202343.png]]
	- Emitter State에서 Life Cycle Mode System으로 변경/ NS_Rain의 System State에서 Lifetime을 1로 변경
	- Spawn Burst 삭제 후 Spawn Rate 추가 -> SpawnRate 2000으로 설정
	- Initiallize Particle 값 변경(Sprite Size 변경에 주목)
	![[Pasted image 20241027203258.png]]
	- Shape Location 모듈 추가
	- Scale Sprite Size 모듈 추가, 상승 곡선으로 변경
	- Gravity Force  모듈 추가
	- 진행 사항
	![[Pasted image 20241027203424.png]]

##### 110강 : 거리별 밝기
- 위를 볼 때 비 Particle이 사라지는 문제 발생
	- 원인 : 생성 Cylinder Origin 계산이 카메라 전방 벡터 + 위 벡터라서 위를 볼시 대각선 위에 생기는 문제 발생
	- 해결법 ; 위 벡터 계산을 카메라 기준이 아닌 World 기분 절댓값(0,0,1)로 계산하게하여 언제나 우리 위에 있게 하기
	- 과정 :
		- NMS Get Camera Properties Origin 계산 부분 변경
		![[Pasted image 20241027204238.png]]
---
- 빗방울이 카메라에 아주 가까이 다가오면 너무 밝음
	- 원인 : 그냥 비가 너무 밝음
	- 해결법 : 전체적으로 낮추기 보다는 카메라를 기준으로 밝기를 낮추기(가까우면 어둡게=투명하게)
	- 과정 :
		- Scale Color 에서 Scale RGB를 대상으로 Scratch Dynamic Input 생성
		![[Pasted image 20241027205818.png]]
		- DI_BrightnessByDistToCamera 구현
		![[Pasted image 20241027205918.png]]
		![[Pasted image 20241027205930.png]]
	- 이때 CurrentCamearWorldPosition의 경우 기존 System의 Parameter. 가져오는 법
		- System overview로 가서 해당 변수 우클릭 Copy Reference
		- Scratch로 와서 해당 시스템 Base 변수 생성(여기선 Position) 이름에다가 붙여넣기
		- 앞에 System_ 삭제 후 Input->System으로 Namespace 변경
	- 구현한 Scratch의 각 값들을 Scale Color 모듈에서 변경(Random Range Float 사용해서 무작위성 추가)
	![[Pasted image 20241027210201.png]]
	