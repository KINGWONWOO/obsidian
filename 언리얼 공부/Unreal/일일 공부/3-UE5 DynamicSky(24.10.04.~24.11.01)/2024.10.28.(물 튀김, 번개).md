#### Unreal Engine 5 : 강의 하나로 DynamicSky 시스템 완벽 마스터하기!

##### 111강 : 룩업 각도별 밝기
- 카메라 위를 볼 시 비의 밝기가 너무 밝은 문제
	- 해결 : 위를 볼 시 비의 밝기를 낮추기
	- 아이디어 : 전방 벡터와 위 벡터의 내적 후 Arccos 적용 시 각도가 나옴. 이 각도를 기준으로 일정 이하일 시 밝기 낮추기
	- 구현 : 기존의 밝기 제어 모듈인 'DI_BrightnessByDistToCamera' 사용
		- 변수 생성
		![[Pasted image 20241028143507.png]]
		- 밝기 제어
		![[Pasted image 20241028143551.png]]
##### 112강 : 충돌 이벤트
- 빗방울 튀는 것을 위한 Collision Event 설정
- 'MainRainDrops_CPU' 변경사항
	- Collision Module 추가
	- Kill Particles Module 추가 : 변수 값으로 HasCollided 설정
	- Generate Collision Event Module 추가
	- Properties에서 Requires Persistenet IDs 활성화
- 충돌 시 생성될 Particle인 'RainSplashes' 추가(Parent는 SimpleSpriteBurst)
	- Stage클릭 후 Event Handler 추가
	- Receive Collision Event Module 추가 값 입력
		- Source : MainRainDrop의 Collision Event
		- Execution Mode : Spawned Particles(이래야 안 깜빡임)
		- Max Events Per Frame : 프레임당 이벤트 발생 횟수(10)
		- Spawn Number : 스폰 갯수(10)
	- Emitter State에서 Life Cycle System으로 변경
	- Scale Burst Module 삭제
##### 113강 : 빗방울 튐
- 새로 만든 Emitter에 사용할 Material Instance 생성을 위해, 기존의 'M_LiquidMaster_Additive'를 사용하여 'MI_RainSplashes_Additive'생성
![[Pasted image 20241028150052.png]]
- 나이아가라 시스템의 'RainSplashes' Emitter에서 Sprite Renderer로 가서 해당 MI 적용 후 SUB UV값 4-4로 변경.
- 정확한 빗방울 생성 위치를 조정하기 위해 'MainRainDrops_CPU'의 Collision에서 Particle Radius Scale 낮추기(0.15)
- 'RainSplashes' 속성 조정
	- LifeTIme Random화(0.5-0.75)
	- Color에 NID_RandomOpacity(동적 스크래치 사용자 모듈) 적용(0.3-0.5)
	- Sprite Size 'Random Uniform'으로 변경 후 값 적용(25-50)
	- Dynamic Material Parameter Module 추가 및 값 조정
	![[Pasted image 20241028151053.png]]
- Local Module(동적 스크래치) 다른 나이아가라 시스템에도 노출하는 법
	- 해당 모듈 우클릭 후 'create Asset' 저장
	- Asset 들어가서 Category 설정 후, Library Visibility를 Exposed로 변경
##### 114강 : GPU 비
- GPU Emitter인 'MainRainDrops_GPU' 생성
	- CPU Emitter 복사 붙여넣기
	- Properties에서 값 변경
	![[Pasted image 20241028152144.png]]
	- Generate Event 모듈 삭제 및 Collision/Kill Particles 비활성화
	- Spawn Rate에서 Multiply Float로 바꾼 후 A에는 CPU와 같은 Rate값, B에는 배율을 설정(사진 속에서는 CPU보다 10배 많은 Particle을 생성한다는 뜻)
	![[Pasted image 20241028152309.png]]
---
- 비가 User Pawn에는 충돌이 안됐으면 좋겠음
	- 해결법 : Collision 모듈에서 Collsion Channel을 Visibility로 설정(어떤 채널을 쓸지 모르겠다면 ThirdPerson BP로 들어가서 Collision Capsule의 채널을 보고 결정)
	![[Pasted image 20241028152603.png]]
##### 115강 : 섹션 챌린지 : Rain FX 토글
- Rainy 일때만 비가 오도록 구현하기
	- ViewPort에서 NS_Rain 삭제
	- BP_DynamicSky에서 Niagara Component 추가 및 NS_Rain 할당/Auto Activate 비활성화
	![[Pasted image 20241028153454.png]]
	- Toggle Rain 후반부에 노드 추가
	![[Pasted image 20241028153513.png]]
##### 117강 : Rain FX 사용자 매개변수
- NS_Rain속 속성을 BP_DynamicSky의 Detail에서 조정할 수 있도록 설정
	- NS_Raint에서 User Parameter 생성
	![[Pasted image 20241028165414.png]]
	- S_RainyWeatherSettings에 해당 User Parameter들 추가
	 ![[Pasted image 20241028165453.png]]
	 - BP_DynamicSky에서 해당 속성을 Detail을 통해 제어할 수 있도록 Macro 'SetRainParticlesSettings' 추가 및 구현
	 ![[Pasted image 20241028165555.png]]
##### 118강 : 피지컬 머터리얼
- Physical Material : Material을 통해 물리적으로 시뮬레이션된 Primitive가 적용된 Asset으로 물리적 객체가 세계와 동적으로 상호작용할 때의 반응을 정의하는데 도움을 줌.
- Puddle 물튀김을 생성하는 과정
	1. Project Settings : 프로젝트 설정에서 사용자 정의 물리 머터리얼 타입을 정의
	![[Pasted image 20241028170919.png]]
	2. Physical Material Asset : 물리 머터리얼 에셋 생성 후 Puddle로 설정
	![[Pasted image 20241028172549.png]]
	![[Pasted image 20241028172636.png]]
	3. Phys 인식 logic 처리
		3-1.  AN_SpawnFootprints에서 Is_Sunny 매크로를 ShouldDoLineTrace로 이름 변경 후 내부 로직 변경
		![[Pasted image 20241028173045.png]]
		3-2. GetCurrentWeather Type에서 Rainy 처리 부분 추가 구현
		![[Pasted image 20241028173304.png]]
	4. Landscape Phys Material Output 처리 : 다음 장 설명
##### 119강 : 랜드스케이프 피지컬 머터리얼 출력
4. Landscape Physical Material Output 처리
	- Node 주의 사항 : 
		- 랜드스케이프와 랜드스케이프 머터리얼과 함께 사용
		- 입력 소켓은 단일 float값
		- Material Parameter Collection과 같이 작동하지 않음(기본값만 받고 머터리얼 노드 내 업데이트를 고려하지 않음)
	- 과정 :
		1. AutoLandscape Material에서 우클릭 후 노드 생성 및 입력값 추가 후 PM_Puddle 추가
		![[Pasted image 20241028174120.png]]
		2. 해당 Input Socket에는 Puddle의 위치를 알려줄 단일 Float값이 필요한데 어떡하지? -> MF_GenerateRainyWeatherPuddles 안에서 Noise Texture를 통해 Mask를 생성했었지 -> 밖에서는 접근 불가능한데 어떻게 해야할까 -> 출력핀을 추가해서 해당 마스크를 연결하자!
		![[Pasted image 20241028174824.png]]
		4. 0~1사이의 애매한 부분을 밟아도 웅덩이가 detect되기 때문에 Round를 통해 반올림하여 애매한 부분들 삭제
		![[Pasted image 20241028174949.png]]
##### 120강 : 물웅덩이 물튀김
- PuddleSplash를 표현하기 위한 Material인 MI_PuddleSplashes_Additive 생성(Base는 M_LiquidMaster_Additive)
![[Pasted image 20241028180849.png]]
- 해당 Material을 사용할 NS_PuddleSplash 생성(Simple Sprite Burst)
![[Pasted image 20241028183652.png]]
- NS_PuddleSplash 내부 속성 변경
	- Sprite Renderer에서 Material변경
	- 각종 속성들 Random Float 설정
	- Dynamic Material Paramter 추가
	- Scale Sprite Size 모듈 추가 후 Ease-in 그래프 설정
	- Scale Sprite Size의 사이즈 증가의 시작점이 밑이였으면 좋겠으므로 Sprite Renderer에서 Default Pivot 위치 변경
	![[Pasted image 20241028183945.png]]
	- Pivot 위치 변경으로 Particle의 위치가 위로 올라갔으므로 Initialize Particle에서 Position Offset을 통해 조정
	![[Pasted image 20241028184028.png]]
- AnimNotify에서 Rainy일 때 해당 NS Spawn 하도록 구현
![[Pasted image 20241028184551.png]]

##### 122강 : 번개 플래시
- 번개 표현을 위한 NS_Lightning 생성
- 번개 플래시의 특징
	- 매우 순간적 : LifeTime을 매우 짧게 설정
	![[Pasted image 20241028190416.png]]
	- User 기준 엄청 위에 존재 : DynamicSpawnOrigin 기준 Z축을 많이 증가시킨 위치에 Position Offset 설정
	![[Pasted image 20241028190520.png]] 
	- NDI_ComputeLargeNumber는 큰 숫자를 쉽게 입력할 수 있는 사용자 정의 Scratch Dynamic Input
	![[Pasted image 20241028190628.png]]
	- 아주 큼 : Sprite Size에 아주 큰 값 부여
	![[Pasted image 20241028190703.png]]
	- 생성에 무작위성 필요 : Sprite Burst Instantaneous에 Random Float 추가, Loop Duration에 Random Float 추가
	![[Pasted image 20241028190745.png]]
	![[Pasted image 20241028190808.png]]

##### 123강 : 번개 볼트
- Lightning Bolt를 표현하기 위한 Material 생성
![[Pasted image 20241028200028.png]]
- NS_Lightning에서 새로운 Emitter LightningBolt(Simple Sprite Burst) 생성 및 속성 변경
	- 크기 변경
	![[Pasted image 20241028200205.png]]
	- Sub UV 설정 변경(4-1), Sub UV Animation 추가
- Bolt 카메라에서 밀어내고 Random 생성하기
	- Camera 기준 거리를 만들고 특정 범위 내에서 Random한 위치값을 반환하는 Scratch Input을 만든 후 Position에 할당
	![[Pasted image 20241028204221.png]]
	![[Pasted image 20241028204230.png]]
	- Initialize Particle 내부 구현
	![[Pasted image 20241028204651.png]]
- Scale Sprite Size 모듈 추가 후 내부 수정![[Pasted image 20241028204342.png]]
- 위에서부터 변화가 시작되기를 원하니 Pivot 값 변경(0.5-0), 변경에 따라 Z축 이동이 생기기 때문에 보정해주기 위해 UpOffsetScale의 값 조정
- Spawn Burst Instantaneous 모듈 생성 후 랜덤 생성 구현(0.5-0.6)
